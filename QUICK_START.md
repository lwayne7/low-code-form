# 快速开始 - 性能测试和E2E测试

## 🚀 5分钟快速体验

### 1. 安装依赖

```bash
npm install --legacy-peer-deps
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:5173

---

## 🧪 测试新功能

### 性能监控面板

1. 点击工具栏的 **"性能监控"** 图标（仪表盘图标）
2. 实时查看：
   - 当前FPS和平均FPS
   - 渲染次数统计
   - 内存使用情况
   - 高频渲染组件Top 5

3. 尝试性能压力测试：
   - 点击 **"100组件"** 按钮（添加100个测试组件）
   - 点击 **"500组件"** 按钮（添加500个测试组件）
   - 点击 **"1000组件"** 按钮（添加1000个测试组件）

4. 观察性能变化：
   - FPS是否保持在55+
   - 内存使用是否稳定
   - 是否有长任务警告

5. 导出性能报告：
   - 点击 **"下载"** 图标
   - 获得JSON格式的性能报告

### 虚拟滚动测试

1. 添加超过50个组件（手动或使用压力测试）
2. 观察界面提示：**"⚡ 虚拟滚动已启用"**
3. 滚动列表，体验流畅的性能
4. 对比非虚拟滚动模式（<50个组件）

### 浏览器控制台性能测试

```javascript
// 打开浏览器控制台（F12）

// 1. 生成1000个测试组件
window.performanceTest.generateTestComponents(1000);

// 2. 生成嵌套结构（深度5层，每层3个节点）
window.performanceTest.generateNestedStructure(5, 3);

// 3. 生成完整性能报告
await window.performanceTest.generatePerformanceReport();

// 4. 压力测试（测试FPS降至30时的组件数量）
window.performanceTest.stressTest(30);
```

---

## 📊 运行性能基准测试

```bash
# 运行所有基准测试
npm run bench

# 预期输出示例：
# ✓ 添加 100 个组件 (200ms)
# ✓ 添加 500 个组件 (800ms)
# ✓ 添加 1000 个组件 (1.5s)
# ✓ 在 100 个组件中查找 (<1ms)
# ...
```

### 查看基准测试结果

测试完成后会显示：
- 每个测试场景的耗时
- 性能对比
- 通过/失败状态

---

## 🎭 运行E2E测试

### 首次运行（需要安装浏览器）

```bash
# 安装Playwright浏览器
npx playwright install

# 运行E2E测试
npm run test:e2e
```

### 使用UI模式（推荐）

```bash
npm run test:e2e:ui
```

这会打开Playwright UI界面，你可以：
- 查看所有测试用例
- 单步调试测试
- 查看测试视频和截图
- 实时查看测试执行

### 运行特定测试

```bash
# 只运行基础操作测试
npx playwright test basic-operations

# 只运行拖拽测试
npx playwright test drag-and-drop

# 只运行性能测试
npx playwright test performance
```

### 查看测试报告

```bash
# 测试完成后自动打开报告
npx playwright show-report
```

---

## 🏆 运行Lighthouse性能测试

```bash
# 构建并运行Lighthouse
npm run lighthouse
```

测试完成后：
1. 报告保存在 `.lighthouseci/` 目录
2. 查看HTML报告获取详细分数
3. 检查性能、可访问性、最佳实践、SEO评分

---

## 📈 性能指标解读

### FPS（帧率）
- **≥ 55**: 流畅 ✅
- **30-54**: 一般 ⚠️
- **< 30**: 卡顿 ❌

### 内存使用
- **< 50MB**: 优秀 ✅
- **50-100MB**: 正常 ⚠️
- **> 100MB**: 偏高 ❌

### 长任务
- **0次**: 完美 ✅
- **1-5次**: 可接受 ⚠️
- **> 5次**: 需优化 ❌

### Lighthouse分数
- **≥ 90**: 优秀 ✅
- **80-89**: 良好 ⚠️
- **< 80**: 需改进 ❌

---

## 🎯 测试场景清单

### ✅ 必测场景

1. **小数据量（< 50组件）**
   - 添加10个组件
   - 拖拽排序
   - 属性修改
   - 预览导出

2. **中数据量（50-500组件）**
   - 批量添加100个组件
   - 观察虚拟滚动启用
   - 测试滚动流畅度
   - 检查内存使用

3. **大数据量（1000+组件）**
   - 使用压力测试添加1000组件
   - 检查FPS是否 ≥ 55
   - 测试撤销/重做性能
   - 导出性能报告

4. **嵌套结构**
   - 创建5层嵌套容器
   - 拖拽组件到不同层级
   - 测试跨容器移动
   - 检查渲染性能

---

## 🐛 常见问题

### Q: 性能测试工具在控制台不可用？
A: 确保开发服务器正在运行（`npm run dev`），工具会自动加载。

### Q: E2E测试失败？
A: 
1. 确保开发服务器在运行
2. 检查端口是否为5173
3. 运行 `npx playwright install` 安装浏览器

### Q: Lighthouse测试失败？
A: 
1. 先运行 `npm run build`
2. 确保构建成功
3. 检查 `.lighthouseci/` 目录权限

### Q: 虚拟滚动没有启用？
A: 虚拟滚动在组件数量 > 50 时自动启用，添加更多组件即可。

---

## 📊 性能优化建议

### 开发时
1. 使用性能监控面板实时查看FPS
2. 避免频繁的全量渲染
3. 合理使用React.memo和useMemo
4. 大列表自动启用虚拟滚动

### 测试时
1. 运行性能基准测试建立baseline
2. E2E测试验证功能正确性
3. Lighthouse测试检查整体性能
4. 导出性能报告对比优化效果

### 生产部署前
1. ✅ 运行完整测试套件
2. ✅ 检查Lighthouse分数 ≥ 80
3. ✅ 验证大数据量性能
4. ✅ 导出性能报告存档

---

## 🎉 开始测试吧！

```bash
# 1. 启动项目
npm run dev

# 2. 打开性能监控面板，体验实时监控

# 3. 运行压力测试，查看1000组件性能

# 4. 运行完整测试套件
npm test              # 单元测试
npm run bench         # 性能基准测试
npm run test:e2e:ui   # E2E测试（UI模式）
npm run lighthouse    # Lighthouse测试
```

---

**祝测试顺利！** 🚀

有问题请查看 `docs/TESTING.md` 获取详细测试指南。
